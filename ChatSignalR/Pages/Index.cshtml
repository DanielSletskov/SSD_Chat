@page
@model IndexModel
@{
    ViewData["Title"] = "Chat";
}

<div class="container">
    <div>
        <input type="text" id="senderName" placeholder="Enter name...">
        <label>Insert name</label>
    </div>
    <div class="mt-5">
        <input type="text" id="message" />
        <input type="button" id="SendMessage" value="Send"/>
    </div>

    <div class="mt-3">
        <ul id="discussion"> </ul>
    </div>
    <div id="chatSection" class="row justify-content-center" style="display:none;">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h4 id="chatTitle">Secure Chat</h4>
                    <span id="connectionStatus" class="text-success"></span>
                </div>
                <div class="card-body" id="chatMessages" style="height: 400px; overflow-y: scroll;">
                    <!-- Messages will be appended here -->
                </div>
                <div class="card-footer">
                    <div class="input-group">
                        <input type="text" id="messageInput" class="form-control" placeholder="Type your message..." disabled />
                        <button id="sendMessageBtn" class="btn btn-success" disabled>Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/@@microsoft/signalr@8.0.7/dist/browser/signalr.min.js"> </script>
<script>
    var connection = new signalR.HubconnectionBuilder()
	.WithWrl("Chat").build();

    connection.start().then(function () {
        console.log("Connected to SignalR hub");
			}).catch(function (err){
        return console.error(err.toString());
    });

    document.getElementById("SendMessage").addEventListener("click", function (event){
        var user = document.getElementById("senderName").value;
        var message = document.getElementById("message").value;

        connection.Invoke("SendMessage", user,  message).catch(function (err) {
            return console.error(err.toString());
        });

        event.preventDefault();
    })

    connection.on("ReceiveMessage", function (user,message) {
        var encodedMsg = user +": " + message;
        var li = document.createElement("li");

        li.textContent = encodedMsg;
        document.getElementById("discussion").appendChild(li);
    });
</script>